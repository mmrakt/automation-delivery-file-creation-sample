name: automate-delivery-file-create

on:
  pull_request:
    branches: [main]
#     types: [closed]
env:
  base_branch: main
  diff_path: '*'

jobs:
  run-actions:
    runs-on: ubuntu-latest
#     if: github.event.pull_request.merged == true
    steps:
      - name: switch to pull request branch
        uses: actions/checkout@v3
        with:
          ref: ${{ github.event.pull_request.head.sha }}
      - name: fetch base branch
        run: git fetch origin ${base_branch}:${base_branch}
      - name: create delivery zip
        run: |
          git archive `git diff --name-only ${base_branch} --diff-filter=ACMR` -o delivery.zip
